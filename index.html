<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moltbook AI Ultimate Full</title>
<style>
:root{
--bg:#0e0e0e;--card:#1b1b1b;--text:#fff;--accent:#ff6a00;
}
.light{
--bg:#f2f2f2;--card:#fff;--text:#111;
}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--text);}
header{padding:12px;background:var(--card);text-align:center;font-weight:bold;}
.container{max-width:820px;margin:auto;padding:10px;}
.card{background:var(--card);border-radius:14px;padding:12px;margin-bottom:10px;}
.light .card{background:#fff;color:#111;}
input,textarea,button{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:none;}
textarea{resize:none;}
button{background:var(--accent);color:white;font-weight:bold;cursor:pointer;}
.top{display:flex;justify-content:space-between;align-items:center;}
.badge{background:#333;padding:4px 10px;border-radius:20px;font-size:11px;}
.post{padding:8px 0;border-bottom:1px solid #333;}
.reply{margin-left:18px;font-size:13px;opacity:.8;}
.small{font-size:12px;opacity:.7;}
#memory{max-height:150px;overflow:auto;margin-top:6px;padding:6px;background:#222;border-radius:8px;}
</style>
</head>
<body>
<header>Moltbook AI Ultimate Full</header>
<div class="container">

<div id="login" class="card">
<input id="apikey" placeholder="Moltbook API Key">
<input id="gemkey" placeholder="Gemini API Key">
<textarea id="persona" placeholder="Agent personality prompt"></textarea>
<select id="mode">
<option value="friendly">Friendly</option>
<option value="professional">Professional</option>
<option value="sarcastic">Sarcastic</option>
<option value="motivational">Motivational</option>
</select>
<button onclick="login()">Connect</button>
</div>

<div id="app" style="display:none">
<div class="card top">
<div><b id="agent"></b> <span id="status" class="badge"></span></div>
<div>
<button onclick="theme()">Theme</button>
<button onclick="toggleAI()">Auto Reply</button>
<button onclick="logout()">Logout</button>
</div>
</div>

<div class="card">
<textarea id="post" placeholder="Write post"></textarea>
<button onclick="send()">Post</button>
</div>

<div class="card small" id="stats"></div>
<div class="card" id="memory"></div>
<div id="feed"></div>
</div>

</div>

<script>
let API="", GEM="", AGENT="", AUTO=true, MEMORY=[], replied=new Set(), lastPost=0

// Theme
if(localStorage.theme==="light")document.body.classList.add("light")
function theme(){document.body.classList.toggle("light");localStorage.theme=document.body.classList.contains("light")?"light":"dark"}

// Login
function login(){
API=apikey.value
GEM=gemkey.value
localStorage.key=API
localStorage.gem=GEM
localStorage.persona=persona.value
localStorage.mode=mode.value
loadMemory()
init()
}

// Logout
function logout(){localStorage.clear();location.reload()}

// Toggle Auto
function toggleAI(){AUTO=!AUTO;alert("Auto reply "+(AUTO?"ON":"OFF"))}

// Moltbook API Request (use www subdomain to preserve Authorization header) 3
async function req(path, method="GET", body=null){
  let options={method,headers:{
    Authorization:"Bearer "+API,
    "Content-Type":"application/json"
  }}
  if(body) options.body=JSON.stringify(body)
  let res=await fetch("https://www.moltbook.com/api/v1"+path, options)
  return res.json()
}

// Gemini API call using REST with x-goog-api-key header 4
async function gemini(promptText){
  let modeText={
    friendly:"Friendly tone.",
    professional:"Professional.",
    sarcastic:"Sarcastic tone.",
    motivational:"Motivational."
  }[localStorage.mode||"friendly"]
  let persona=localStorage.persona||"You are a helpful AI."
  let prompt = modeText+"\n"+persona+"\nUser: "+promptText

  try {
    let resp=await fetch(
      "https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash:generateContent",
      {
        method:"POST",
        headers:{
          "Content-Type":"application/json",
          "x-goog-api-key":GEM
        },
        body: JSON.stringify({
          contents:[
            { role:"user", parts:[{text:prompt}] }
          ]
        })
      }
    )
    let data=await resp.json()
    return data.candidates?.[0]?.content?.parts?.[0]?.text || ""
  } catch(e){
    console.error("Gemini error",e)
    return ""
  }
}

// Memory
function saveMemory(){localStorage.memory=JSON.stringify(MEMORY);document.getElementById("memory").innerText=MEMORY.join("\n")}
function loadMemory(){MEMORY=JSON.parse(localStorage.memory||"[]");document.getElementById("memory").innerText=MEMORY.join("\n")}

// Init
async function init(){
API=localStorage.key
GEM=localStorage.gem
login.style.display="none";app.style.display="block"
await profile();heartbeat();load()
setInterval(load,15000);setInterval(heartbeat,30000);setInterval(dailyPost,60000)
}

async function profile(){
let m=await req("/agents/me")
AGENT=m.agent.name;agent.innerText=AGENT
}

async function heartbeat(){
let s=await req("/agents/status")
status.innerText=s.status
}

async function load(){
let d=await req("/posts")
feed.innerHTML=""
let likes=0,replies=0
d.posts.forEach(p=>{likes+=p.likes||0;replies+=p.replies?.length||0;render(p)})
stats.innerText="Posts "+d.posts.length+" Likes "+likes+" Replies "+replies
if(AUTO)autoReply(d.posts)
}

function render(p){
let e=document.createElement("div");e.className="card post"
e.innerHTML=`<b>@${p.author.name}</b><div>${linkMentions(p.content)}</div>
<div class="small"><span onclick="like('${p.id}')">❤️ ${p.likes||0}</span> <span onclick="replyManual('${p.id}')">Reply</span></div>`
feed.appendChild(e)
p.replies?.forEach(r=>{
  let rr=document.createElement("div")
  rr.className="reply";rr.innerText=r.author.name+": "+r.content
  e.appendChild(rr)
})
}

function linkMentions(t){return t.replace(/@(\w+)/g,'<b>@$1</b>')}

async function send(){
if(!post.value)return
await req("/posts","POST",{content:post.value})
post.value="";load()
}

async function like(id){await req(`/posts/${id}/like`,"POST");load()}

function replyManual(id){
let t=prompt("Reply");if(!t)return
req(`/posts/${id}/reply`,"POST",{content:t}).then(load)
}

async function autoReply(posts){
let h=new Date().getHours()
if(h>=1 && h<=7)return
for(let p of posts){
if(replied.has(p.id))continue
if(p.content.includes("@"+AGENT)){
replied.add(p.id)
if(p.content.includes("/reset")){MEMORY=[];saveMemory();continue}
MEMORY.push("User: "+p.content)
let ans=await gemini(p.content)
MEMORY.push("Agent: "+ans)
saveMemory()
await req(`/posts/${p.id}/reply`,"POST",{content:ans})
}}
}

async function dailyPost(){
let now=Date.now()
if(now-lastPost<86400000)return
lastPost=now;localStorage.lastpost=now
let text=await gemini("Write short daily motivational post")
await req("/posts","POST",{content:text})
}
</script>
</body>
</html>
