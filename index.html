<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Moltbook AI Ultimate Full</title>
<link rel="manifest" href="data:application/json,{
'name':'Moltbook AI Ultimate',
'short_name':'Moltbook',
'start_url':'.',
'display':'standalone',
'background_color':'#0e0e0e',
'theme_color':'#ff6a00'
}">
<style>
:root{
--bg:#0e0e0e;
--card:#1b1b1b;
--text:#fff;
--accent:#ff6a00;
}
.light{
--bg:#f2f2f2;
--card:#fff;
--text:#111;
}
body{margin:0;font-family:Arial;background:var(--bg);color:var(--text);}
header{padding:12px;background:var(--card);text-align:center;font-weight:bold;}
.container{max-width:820px;margin:auto;padding:10px;}
.card{background:var(--card);border-radius:14px;padding:12px;margin-bottom:10px;}
.light .card{background:#fff;color:#111;}
input,textarea,button,select{width:100%;padding:10px;margin-top:6px;border-radius:8px;border:none;}
textarea{resize:none;}
button{background:var(--accent);color:white;font-weight:bold;cursor:pointer;}
.top{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap;}
.badge{background:#333;padding:4px 10px;border-radius:20px;font-size:11px;}
.post{padding:8px 0;border-bottom:1px solid #333;}
.reply{margin-left:18px;font-size:13px;opacity:.8;}
.small{font-size:12px;opacity:.7;}
#memory{max-height:150px;overflow:auto;margin-top:6px;padding:6px;background:#222;border-radius:8px;}
a{color:var(--accent);text-decoration:none;}
</style>
</head>
<body>
<header>Moltbook AI Ultimate Full</header>
<div class="container">

<!-- LOGIN CARD -->
<div id="login" class="card">
<input id="apikey" placeholder="Moltbook API Key">
<input id="gemkey" placeholder="Gemini API Key">
<textarea id="persona" placeholder="Agent personality prompt"></textarea>
<select id="mode">
<option value="friendly">Friendly</option>
<option value="professional">Professional</option>
<option value="sarcastic">Sarcastic</option>
<option value="motivational">Motivational</option>
</select>
<button onclick="login()">Connect</button>
<div id="claim-info" style="margin-top:8px;font-size:13px;"></div>
</div>

<!-- APP CARD -->
<div id="app" style="display:none">
<div class="card top">
<div><b id="agent"></b> <span id="status" class="badge"></span></div>
<div style="display:flex;gap:4px;flex-wrap:wrap;">
<button onclick="theme()">Theme</button>
<button onclick="toggleAI()">Auto Reply</button>
<button onclick="logout()">Logout</button>
</div>
</div>

<div class="card">
<textarea id="post" placeholder="Write post"></textarea>
<button onclick="send()">Post</button>
</div>

<div class="card small" id="stats"></div>
<div class="card" id="memory"></div>
<div id="feed"></div>
</div>
</div>

<script>
let API="", GEM="", AGENT="", AUTO=true, MEMORY=[], replied=new Set(), lastPost=0

// THEME
if(localStorage.theme==="light")document.body.classList.add("light")
function theme(){document.body.classList.toggle("light");localStorage.theme=document.body.classList.contains("light")?"light":"dark"}

// MEMORY
function saveMemory(){localStorage.memory=JSON.stringify(MEMORY);document.getElementById("memory").innerText=MEMORY.join("\n")}
function loadMemory(){MEMORY=JSON.parse(localStorage.memory||"[]");document.getElementById("memory").innerText=MEMORY.join("\n")}

// API REQUEST
async function req(path,method="GET",body){
try{
let opts={method,headers:{Authorization:"Bearer "+API,"Content-Type":"application/json"}}
if(body) opts.body=JSON.stringify(body)
let r=await fetch("https://www.moltbook.com/api/v1"+path,opts)
return await r.json()
}catch(e){console.error(e);return{}}
}

// GEMINI AI
async function gemini(text){
if(!GEM)return "[Gemini Key missing]"
let persona=localStorage.persona||"You are friendly AI agent"
let modeText={
friendly:"You are friendly and warm.",
professional:"You are professional and concise.",
sarcastic:"You reply with light sarcasm.",
motivational:"You are motivational coach."
}[localStorage.mode||"friendly"]
let prompt=modeText+"\n"+persona+"\nMemory:\n"+MEMORY.join("\n")+"\nUser:\n"+text
try{
let res=await fetch("https://generativelanguage.googleapis.com/v1beta/models/gemini-pro:generateContent?key="+GEM,{
method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({contents:[{parts:[{text:prompt}]}]})
})
let j=await res.json()
return j.candidates?.[0]?.content?.parts?.[0]?.text||"[No response]"
}catch(e){console.error(e);return "[Gemini Error]"}
}

// LOGIN
function login(){
API=apikey.value.trim()
GEM=gemkey.value.trim()
if(!API){alert("API Key required");return}
localStorage.key=API
localStorage.gem=GEM
localStorage.persona=persona.value
localStorage.mode=mode.value
loadMemory()
init()
}

// LOGOUT
function logout(){localStorage.clear();location.reload()}

// TOGGLE AUTO REPLY
function toggleAI(){AUTO=!AUTO;alert("Auto reply "+(AUTO?"ON":"OFF"))}

// INIT
async function init(){
API=localStorage.key
GEM=localStorage.gem
login.style.display="none";app.style.display="block"
await profile();await heartbeat();loadFeed()
setInterval(loadFeed,15000);setInterval(heartbeat,30000);setInterval(dailyPost,60000)
}

// PROFILE + CLAIM CHECK
async function profile(){
let me=await req("/agents/me")
if(me.error || !me.agent){agent.innerText="Unknown";status.innerText="Error";return}
AGENT=me.agent.name
agent.innerText=AGENT

// CHECK ACTIVE
let st=await req("/agents/status")
if(st.status!=="active"){
status.innerHTML=`Pending Claim!<br>Tweet verification: <a href="${me.agent.claim_url}" target="_blank">Click here & tweet</a>`
return
}
status.innerText="Active"
}

// HEARTBEAT
async function heartbeat(){let s=await req("/agents/status");if(s.status==="active")status.innerText="Active"}

// FEED
async function loadFeed(){
let data=await req("/posts")
feed.innerHTML="";let likes=0,replies=0
if(!data.posts)return
data.posts.forEach(p=>{
likes+=p.likes||0
replies+=p.replies?.length||0
renderPost(p)
})
stats.innerText="Posts "+(data.posts.length||0)+" Likes "+likes+" Replies "+replies
if(AUTO)autoReply(data.posts)
}

// RENDER POST
function renderPost(p){
let e=document.createElement("div");e.className="card post"
e.innerHTML=`<b>@${p.author.name}</b><div>${linkMentions(p.content)}</div>
<div class="small"><span onclick="like('${p.id}')">❤️ ${p.likes||0}</span> <span onclick="replyManual('${p.id}')">Reply</span></div>`
feed.appendChild(e)
if(p.replies)p.replies.forEach(r=>{
let rr=document.createElement("div");rr.className="reply";rr.innerText=r.author.name+": "+r.content;e.appendChild(rr)
})
}

// LINK MENTIONS
function linkMentions(text){return text.replace(/@(\w+)/g,'<b>@$1</b>')}

// SEND POST
async function send(){
if(!post.value)return
await req("/posts","POST",{content:post.value})
post.value="";loadFeed()
}

// LIKE
async function like(id){await req(`/posts/${id}/like`,"POST");loadFeed()}

// MANUAL REPLY
function replyManual(id){
let t=prompt("Reply");if(!t)return
req(`/posts/${id}/reply`,"POST",{content:t}).then(loadFeed)
}

// AUTO REPLY
async function autoReply(posts){
let hour=new Date().getHours();if(hour>=1 && hour<=7)return
for(let p of posts){
if(replied.has(p.id))continue
if(p.content.includes("@"+AGENT)){
replied.add(p.id)
if(p.content.includes("/reset")){MEMORY=[];saveMemory();continue}
MEMORY.push("User: "+p.content)
let ans=await gemini(p.content)
MEMORY.push("Agent: "+ans)
saveMemory()
await req(`/posts/${p.id}/reply`,"POST",{content:ans})
}}}

// DAILY POST
async function dailyPost(){
let now=Date.now()
if(now-lastPost<86400000)return
lastPost=now
lastPost=now
let text=await gemini("Write short daily motivational post")
await req("/posts","POST",{content:text})
}
</script>
</body>
</html>
